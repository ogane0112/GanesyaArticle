---
title: "headersã«ã¤ã„ã¦(Next.js)"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Next.js"]
published: false
---
## ã¯ã˜ã‚ã«
ä»Šå›ã®è¨˜äº‹ã§ã¯Next.jsã®headersã«ã¤ã„ã¦å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚‚ã¨ã«ç†è§£ã—ãŸã“ã¨ã‚’ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã—ã¦ã„ãã¾ã™ï¼
é–“é•ã„ãªã©ãŒã‚ã£ãŸã‚‰ã©ã—ã©ã—æŒ‡æ‘˜ã—ã¦ãã ã•ã„ï¼ã“ã‚Œã‹ã‚‰æ¯æ—¥ã€NEXT.jsã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªåˆ†ãªã‚Šã«ç†è§£ã—ãŸã“ã¨ã‚’ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã—ã¦ã„ãã®ã§ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼

## headersã¨ã¯
```js
import { headers } from 'next/headers';

export async function GET(request: Request) {
  const headerList = headers();
  //ä¸‹ï¼’è¡Œã®ã‚³ãƒ¼ãƒ‰ã¯headersã®å†…å®¹ã‚’è¦‹ã‚‹ç”¨ã®ã‚³ãƒ¼ãƒ‰ã§ã™ï¼
  const headersObj = Object.fromEntries(headersList.entries());
  console.log(headersObj);
}
```
ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ãªæ„Ÿã˜ã§å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã€ä¸‹ã®ã‚ˆã†ãªæƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼
```bash
{
  host: 'localhost:3000',
  connection: 'keep-alive',
  'sec-ch-ua': '"Chromium";v="128", "Not;A=Brand";v="24", "Microsoft Edge";v="128"',
  'sec-ch-ua-mobile': '?0',
  'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0',
  'sec-ch-ua-platform': '"Windows"',
  accept: '*/*',
  'sec-fetch-site': 'same-origin',
  'sec-fetch-mode': 'cors',
  'sec-fetch-dest': 'empty',
  referer: 'http://localhost:3000/',
  'accept-encoding': 'gzip, deflate, br, zstd',
  'accept-language': 'ja,en;q=0.9,en-GB;q=0.8,en-US;q=0.7,zh-CN;q=0.6,zh;q=0.5',
  cookie: '',
  'x-forwarded-host': 'localhost:3000',
  'x-forwarded-port': '3000',
  'x-forwarded-proto': 'http',
  'x-forwarded-for': '::1'
}
```
ä½¿ç”¨æ–¹æ³•ã¨ã—ã¦ã¯ã€åƒ•ãŒãŒæ€ã„ã¤ãé™ã‚Šã ã¨ã€x-forwarded-protoã®å€¤ã‚’è¦‹ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å¤‰æ›´ã—ãŸã‚Šã€refererã®å€¤ã‚’åˆ©ç”¨ã—ã¦APIã‚’å©ã„ãŸã‚Šã™ã‚‹ã“ã¨ãã‚‰ã„ã—ã‹æ€ã„ã¤ãã¾ã›ã‚“ã§ã—ãŸ(Â´;Ï‰;ï½€)
è¿½åŠ ã§ãã‚Œãã‚Œã®è¦ç´ ã«ã¤ã„ã¦ã¯ï¼¡ï¼©ã«èã„ã¦ã¿ãŸçµæœã¨åƒ•ã®èª¿ã¹ãŸçµæœã‚’ã¾ã¨ã‚ãŸè¡¨ãŒã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼

## ä½¿ç”¨ä¾‹
å…·ä½“çš„ãªä½¿ç”¨ã—ãŸä¾‹ã‚’ã‚‚ã¨ã«èª¬æ˜ã—ã¦ã„ãã¾ã™ï¼
```js
import { headers } from 'next/headers';

export async function GET(request: Request) {
  const headerList = headers();
  const headersObj = Object.fromEntries(headersList.entries());
  const isLocalhost = headersObj['x-forwarded-host'] === 'localhost:3000';
  const protocol = isLocalhost ? 'http' : 'https';
  const host = isLocalhost ? 'localhost:3000' : 'your-production-domain.com';
  const url = `${protocol}://${host}${request.url}`;
  console.log(url);
}
```
ä¸Šè¨˜ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§åˆ©ç”¨ã—ã¾ã—ãŸï¼
ä½¿ç”¨ã—ãŸç†ç”±ã¨ã—ã¦ã¯,vercelãªã©ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã‚ˆã£ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ãŒå¤‰ã‚ã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€ãã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã‚ˆã£ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã‚’å¤‰æ›´ã—ãŸã„ã¨ãã«ä½¿ç”¨ã—ã¾ã—ãŸï¼
## å‚è€ƒ
https://nextjs.org/docs/app/api-reference/functions/headers
